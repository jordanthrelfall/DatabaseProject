<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta viewport="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="loginSection">
        <h2>Login Form</h2>
        <form id="loginForm">
            UserID:<br>
            <input type="text" name="UserID" required>
            <br>
            Password:<br>
            <input type="password" name="Password" required>
            <br><br>
            <input type="button" value="Login" onclick="login()">
        </form>
        <button onclick="showRegistration()">Don't have an account? Register</button>
    </div>
    
    <div id="registrationSection" class="hidden">
        <h2>Register</h2>
        <form id="registrationForm">
            UniversityID:<br>
            <input type="text" name="UserID" required>
            <br>
            Email:<br>
            <input type="text" name="Email" required>
            <br>
            Password:<br>
            <input type="password" name="Password" required>
            <br><br>
            <input type="button" value="Register" onclick="register()">
        </form>
        <button onclick="showLogin()">Have an account? Login</button>
    </div>
    

<div id="dataSection" class="hidden">
    <h2>Database Contents</h2>
    <table id="dataTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be inserted here -->
        </tbody>
    </table>
</div>



<script>

function showRegistration() {
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('registrationSection').classList.remove('hidden');
}

function showLogin() {
    document.getElementById('registrationSection').classList.add('hidden');
    document.getElementById('loginSection').classList.remove('hidden');
}

function register() {
    var formData = new FormData(document.getElementById('registrationForm'));

    fetch('php/register.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.text())
    .then(result => {
        if(result !== "Registration failed") {
            alert("Registration successful. Your UserID is " + $uid);
            window.location.href = 'index.html';
            document.getElementById('registrationSection').classList.add('hidden');
        } else {
            alert("Registration failed. Please try again.");
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function login() {
    var formData = new FormData(document.getElementById('loginForm'));

    fetch('php/login.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            sessionStorage.setItem('UserID', data.UserID); // Save UserID to session storage
            document.getElementById('loginSection').classList.add('hidden');
            fetchData(); // Assuming this function is okay as is
            // Redirect based on userType
            if (data.Role === 'student') {
                window.location.href = 'student_home.html';
            } else if (data.Role === 'admin') {
                window.location.href = 'admin_home.html';
            }
        } else {
            alert("Login Failed. Please try again.");
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function fetchData() {
    fetch('php/display.php')
    .then(response => response.json())
    .then(data => {
        const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
        data.forEach(row => {
            let newRow = tableBody.insertRow();
            let cell1 = newRow.insertCell(0);
            let cell2 = newRow.insertCell(1);
            cell1.innerHTML = row.id;
            cell2.innerHTML = row.name;
        });
    })
    .catch(error => console.error('Error:', error));
}

// Load the data when the page loads
window.onload = fetchData;
</script>

</body>
</html>
